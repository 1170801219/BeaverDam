!function(e){e.imgplay=function(t,s){var n={name:"imgplay",rate:1,controls:!0,pageSize:5},a=this,o=t,i=e(t),r=null,l=null,c=!1,u="forward",d=0,m=0,p=[],f=null,v=[];a.settings={},a.getTotalFrames=function(){return d},a.controls={play:null,pause:null,stop:null,rewind:null,forward:null,previousFrame:null,nextFrame:null,fullscreen:null},a.frames=[],a.init=function(){a.settings=e.extend({},n,s),a.settings.rate=a.settings.rate<.001?.001:a.settings.rate,a.settings.rate=a.settings.rate>100?100:a.settings.rate,i.addClass("imgplay"),r=e('<canvas class="imgplay-canvas">'),l=r.get(0).getContext("2d"),i.append(r),g(),i.find("img").each(function(t,s){""!=e(s).prop("src")?a.frames[t]=s:p[t]=s,d++}).detach(),e(window).resize(C),C()},a.isPlaying=function(){return c},a.getCurrentFrame=function(){return m},a.play=function(){c=!0,u="forward",y(),a.settings.controls&&(a.controls.play.addClass("active"),a.controls.stop.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.pause=function(){c=!1,null!=f&&clearTimeout(f),a.settings.controls&&(a.controls.pause.addClass("active"),a.controls.play.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.stop=function(){c=!1,m=0,a.settings.controls&&(a.controls.stop.addClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.rewind=function(e){var e=parseInt(e);e>0&&m>=e&&(u="backward",m-=e,y()),a.settings.controls&&(a.controls.rewind.addClass("active"),a.controls.forward.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.forward=function(e){var e=parseInt(e);e>0&&d>=m+e&&(u="forward",m+=e,y()),a.settings.controls&&(a.controls.forward.addClass("active"),a.controls.rewind.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.fastRewind=function(e){var e=parseInt(e);e>0&&(u="backward",a.settings.rate=e),y()},a.fastForward=function(e){var e=parseInt(e);e>0&&(u="forward",a.settings.rate=e),y()},a.previous=function(){},a.next=function(){},a.previousFrame=function(){c=!1,u="backward",m--,y()},a.nextFrame=function(){c=!1,u="forward",m++,y()},a.toFrame=function(e){if(e=e<0?0:e,a.frames[e])return m=e,y(),m>a.frames.length-a.settings.pageSize/2&&w(),jQuery.Deferred().resolve();for(a.settings.onLoading&&a.settings.onLoading(!0),m=e,loadFrom=e-.1*a.settings.pageSize,loadFrom<0&&(loadFrom=0);a.frames[loadFrom];)loadFrom++;return w(loadFrom).then(function(){a.settings.onLoading&&a.settings.onLoading(!1),m==e&&y()})},a.fullscreen=function(e){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),a.settings.controls&&a.controls.fullscreen.removeClass("active")):(o.requestFullscreen?o.requestFullscreen():o.msRequestFullscreen?o.msRequestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen&&o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),a.settings.controls&&a.controls.fullscreen.addClass("active")),setTimeout(function(){C()},2e3)};var g=function(){if(a.settings.controls&&0==i.find(".imgplay-controls").length){var t=e('<div class="imgplay-controls"></div>'),s=e('<div class="imgplay-progress">'),n=e('<div class="imgplay-buttons">'),o=e('<div class="imgplay-load-bar">'),r=e('<div class="imgplay-play-bar">'),l=e('<div class="imgplay-button imgplay-play"><i class="material-icons">play_arrow</i></div>'),c=e('<div class="imgplay-button imgplay-pause"><i class="material-icons">pause</i></div>'),u=e('<div class="imgplay-button imgplay-stop"><i class="material-icons">stop</i></div>'),m=e('<div class="imgplay-button imgplay-previous-frame"><i class="material-icons">skip_previous</i></div>'),p=e('<div class="imgplay-button imgplay-next-frame"><i class="material-icons">skip_next</i></div>'),f=e('<div class="imgplay-button imgplay-fullscreen"><i class="material-icons">fullscreen</i></div>');l.on("click",function(){a.play()}),c.on("click",function(){a.pause()}),u.on("click",function(){a.stop()}),m.on("click",function(){a.previousFrame()}),p.on("click",function(){a.nextFrame()}),f.on("click",function(){a.fullscreen()}),s.on("click",function(t){var s=e(this),n=t.pageX-s.offset().left,o=s.width(),i=Math.floor(n/o*d);a.toFrame(i)}),o.append(r),s.append(o),n.append([l,c,m,u,p,f]),t.append([s,n]),i.append(t),a.controls.play=l,a.controls.pause=c,a.controls.stop=u,a.controls.previousFrame=m,a.controls.nextFrame=p,a.controls.fullscreen=f}},y=function(){if(null!=l){var t=a.frames[m],s=e(t);if(t){if(s.prop("naturalHeight")>0){var n=r.width(),o=r.height(),i=t.width,d=t.height,v=0,g=0;n>=o?(v=i*(o/d),g=o):(v=n,g=d*(n/i)),l.clearRect(0,0,n,o),l.drawImage(t,(n-v)/2,(o-g)/2,v,g)}}else if(p.length){var h=c;return a.pause(),h&&a.settings.onLoading&&a.settings.onLoading(!0),void w(m,h)}if(m<0||m>a.frames.length)return void a.stop();c&&("forward"==u?(m++,m>a.frames.length-a.settings.pageSize/2&&w()):m--,f=setTimeout(y,Math.ceil(1e3/a.settings.rate))),F()}},w=function(e,t){var s,n=void 0!=e?e:m;if(p.length)for(var o=n;o<a.settings.pageSize+n&&o<p.length;o++){var i=h(o,t);o==e&&(s=i)}return s},h=function(t,s){if(v[t])return v[t];var n=jQuery.Deferred();if(v[t]=n,t<p.length){var o=p[t],i=e(o);i.data("src")&&(i.prop("src",i.data("src")),i.on("load",function(){a.frames[t]=o,F(),s&&t==m+a.settings.pageSize/2&&0==c&&(a.settings.onLoading&&a.settings.onLoading(!1),a.play()),delete v[t],n.resolve()}))}return n},F=function(){if(a.settings.controls){var e=a.frames.length/d*100,t=m/a.frames.length*100;e=e>100?100:e,t=t>100?100:t,i.find(".imgplay-load-bar").css("width",e+"%"),i.find(".imgplay-play-bar").css("width",t+"%")}},C=function(){r.prop({height:i.height(),width:i.width()}),y()};a.fitCanvas=function(){C()},a.init()},e.fn.imgplay=function(t){return this.each(function(){if(void 0==e(this).data("imgplay")){var s=new e.imgplay(this,t);e(this).data("imgplay",s)}})}}(jQuery);