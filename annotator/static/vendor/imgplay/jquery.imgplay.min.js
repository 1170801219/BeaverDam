!function(e){e.imgplay=function(t,s){var n={name:"imgplay",rate:1,controls:!0,pageSize:5},a=this,l=t,r=e(t),i=null,o=null,c=!1,u="forward",m=0,p=0,d=[],v=null;a.settings={},a.getTotalFrames=function(){return m},a.controls={play:null,pause:null,stop:null,rewind:null,forward:null,previousFrame:null,nextFrame:null,fullscreen:null},a.frames=[],a.init=function(){a.settings=e.extend({},n,s),a.settings.rate=a.settings.rate<.001?.001:a.settings.rate,a.settings.rate=a.settings.rate>100?100:a.settings.rate,r.addClass("imgplay"),i=e('<canvas class="imgplay-canvas">'),o=i.get(0).getContext("2d"),r.append(i),f(),r.find("img").each(function(t,s){""!=e(s).prop("src")?a.frames[t]=s:d[t]=s,m++}).detach(),e(window).resize(C),C()},a.isPlaying=function(){return c},a.getCurrentFrame=function(){return p},a.play=function(){c=!0,u="forward",g(),a.settings.controls&&(a.controls.play.addClass("active"),a.controls.stop.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.pause=function(){c=!1,null!=v&&clearTimeout(v),a.settings.controls&&(a.controls.pause.addClass("active"),a.controls.play.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.stop=function(){c=!1,p=0,a.settings.controls&&(a.controls.stop.addClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"),a.controls.rewind.removeClass("active"),a.controls.forward.removeClass("active"))},a.rewind=function(e){var e=parseInt(e);e>0&&p>=e&&(u="backward",p-=e,g()),a.settings.controls&&(a.controls.rewind.addClass("active"),a.controls.forward.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.forward=function(e){var e=parseInt(e);e>0&&m>=p+e&&(u="forward",p+=e,g()),a.settings.controls&&(a.controls.forward.addClass("active"),a.controls.rewind.removeClass("active"),a.controls.stop.removeClass("active"),a.controls.play.removeClass("active"),a.controls.pause.removeClass("active"))},a.fastRewind=function(e){var e=parseInt(e);e>0&&(u="backward",a.settings.rate=e),g()},a.fastForward=function(e){var e=parseInt(e);e>0&&(u="forward",a.settings.rate=e),g()},a.previous=function(){},a.next=function(){},a.previousFrame=function(){c=!1,u="backward",p--,g()},a.nextFrame=function(){c=!1,u="forward",p++,g()},a.toFrame=function(e){return e=e<0?0:e,a.frames[e]?(p=e,g(),p>a.frames.length-a.settings.pageSize/2&&y(),jQuery.Deferred().resolve()):(p=e,y(e).then(function(){g()}))},a.fullscreen=function(e){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),a.settings.controls&&a.controls.fullscreen.removeClass("active")):(l.requestFullscreen?l.requestFullscreen():l.msRequestFullscreen?l.msRequestFullscreen():l.mozRequestFullScreen?l.mozRequestFullScreen():l.webkitRequestFullscreen&&l.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),a.settings.controls&&a.controls.fullscreen.addClass("active")),setTimeout(function(){C()},2e3)};var f=function(){if(a.settings.controls&&0==r.find(".imgplay-controls").length){var t=e('<div class="imgplay-controls"></div>'),s=e('<div class="imgplay-progress">'),n=e('<div class="imgplay-buttons">'),l=e('<div class="imgplay-load-bar">'),i=e('<div class="imgplay-play-bar">'),o=e('<div class="imgplay-button imgplay-play"><i class="material-icons">play_arrow</i></div>'),c=e('<div class="imgplay-button imgplay-pause"><i class="material-icons">pause</i></div>'),u=e('<div class="imgplay-button imgplay-stop"><i class="material-icons">stop</i></div>'),p=e('<div class="imgplay-button imgplay-previous-frame"><i class="material-icons">skip_previous</i></div>'),d=e('<div class="imgplay-button imgplay-next-frame"><i class="material-icons">skip_next</i></div>'),v=e('<div class="imgplay-button imgplay-fullscreen"><i class="material-icons">fullscreen</i></div>');o.on("click",function(){a.play()}),c.on("click",function(){a.pause()}),u.on("click",function(){a.stop()}),p.on("click",function(){a.previousFrame()}),d.on("click",function(){a.nextFrame()}),v.on("click",function(){a.fullscreen()}),s.on("click",function(t){var s=e(this),n=t.pageX-s.offset().left,l=s.width(),r=Math.floor(n/l*m);a.toFrame(r)}),l.append(i),s.append(l),n.append([o,c,p,u,d,v]),t.append([s,n]),r.append(t),a.controls.play=o,a.controls.pause=c,a.controls.stop=u,a.controls.previousFrame=p,a.controls.nextFrame=d,a.controls.fullscreen=v}},g=function(){if(null!=o){var t=a.frames[p],s=e(t);if(t){if(s.prop("naturalHeight")>0){var n=i.width(),l=i.height(),r=t.width,m=t.height,f=0,w=0;n>=l?(f=r*(l/m),w=l):(f=n,w=m*(n/r)),o.clearRect(0,0,n,l),o.drawImage(t,(n-f)/2,(l-w)/2,f,w)}}else if(d.length){var C=c;return a.pause(),void y(p,C)}if(p<0||p>a.frames.length)return void a.stop();c&&("forward"==u?(p++,p>a.frames.length-a.settings.pageSize/2&&y()):p--,v=setTimeout(g,Math.ceil(1e3/a.settings.rate))),h()}},y=function(e,t){var s,n=void 0!=e?e:p;if(n-=.1*a.settings.pageSize,n<0&&(n=0),d.length)for(var l=n;l<a.settings.pageSize+n&&l<d.length;l++){var r=w(l,t);l==e&&(s=r)}return s},w=function(t,s){var n=jQuery.Deferred();if(t<d.length){var l=d[t],r=e(l);r.data("src")&&(r.prop("src",r.data("src")),r.on("load",function(){a.frames[t]=l,h(),s&&t==p+a.settings.pageSize-1&&"forward"==u&&0==c&&a.play(),n.resolve()}))}return n},h=function(){if(a.settings.controls){var e=a.frames.length/m*100,t=p/a.frames.length*100;e=e>100?100:e,t=t>100?100:t,r.find(".imgplay-load-bar").css("width",e+"%"),r.find(".imgplay-play-bar").css("width",t+"%")}},C=function(){i.prop({height:r.height(),width:r.width()})};a.init()},e.fn.imgplay=function(t){return this.each(function(){if(void 0==e(this).data("imgplay")){var s=new e.imgplay(this,t);e(this).data("imgplay",s)}})}}(jQuery);